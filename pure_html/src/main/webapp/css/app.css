/* ======================================================
   DESIGN TOKENS
====================================================== */
:root {
    /* palette */
    --bg: #062a2c;
    --txt: #e8f1f2;
    --muted: #c6d0d1;
    --accent: #ffffff;
    --pill: #ffffff22;
    --pill-brd: #ffffff33;

    /* geometry */
    --radius-pill: 999px;
    --control-h: 58px;
    --control-h-sm: 46px;
    --iconbtn: 42px;
    --iconbtn-sm: 36px;
    --badge: 42px;
    --wrap-max: 460px;
    --page-pad: clamp(12px, 4vw, 36px);

    /* safe areas */
    --safe-top: 12px;
    --safe-left: 12px;
    --safe-right: 12px;
}

@supports (padding:max(0px)) {
    :root {
        --safe-top: max(12px, env(safe-area-inset-top));
        --safe-left: max(12px, env(safe-area-inset-left));
        --safe-right: max(12px, env(safe-area-inset-right));
    }
}

/* ======================================================
   RESET & BASE TYPOGRAPHY
====================================================== */
* { box-sizing: border-box; }
html, body { height: 100%; }
html { scroll-behavior: smooth; }

body {
    margin: 0;
    display: grid;
    place-items: center;
    padding: 24px;
    background: var(--bg);
    color: var(--txt);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body.page-home {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding: 0;
    background:
        radial-gradient(60vmax 60vmax at -10% -20%, rgba(56,227,255,.35), transparent 60%),
        radial-gradient(60vmax 60vmax at 110% 110%, rgba(116,240,192,.35), transparent 60%),
        var(--bg);
}

body.page-tracks { place-items: start center; }

a { color: inherit; text-decoration: none; }
button, input, select, textarea { font: inherit; }
button { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
:focus-visible { outline: 2px solid #9fe7ff; outline-offset: 2px; }

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    margin: -1px;
    padding: 0;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
}

/* ======================================================
   GENERIC LAYOUT HELPERS
====================================================== */
.wrap { width: 100%; max-width: var(--wrap-max); }
.wrap.wide { max-width: 680px; }
.panel { display: grid; gap: 14px; }
.stack { display: grid; gap: 18px; }
.title {
    margin: 0 0 26px;
    text-align: center;
    font-weight: 800;
    letter-spacing: .2px;
    font-size: clamp(1.4rem, 2vw + 1rem, 2rem);
}
.alert {
    margin: 0 0 4px;
    padding: 10px 14px;
    border-radius: 12px;
    font-size: .95rem;
    background: #5a1f1f;
    border: 1px solid #ff8f8f55;
    color: #ffe1e1;
}

/* ======================================================
   FORM CONTROLS
====================================================== */
form { display: grid; gap: 16px; }
.form-group { display: grid; gap: 8px; }
.form-label { color: var(--txt); font-weight: 600; font-size: .95rem; }

.field {
    position: relative;
    display: flex;
    align-items: center;
    height: var(--control-h);
    padding: 0 18px;
    border-radius: var(--radius-pill);
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    overflow: hidden;
}

.field input,
.field textarea {
    width: 100%;
    background: transparent;
    border: 0;
    outline: 0;
    color: var(--txt);
}

.field input { height: 100%; font-size: 1.05rem; }
.field textarea {
    min-height: 60px;
    padding: 0;
    font-size: 1rem;
    resize: vertical;
}

.field.textarea {
    height: auto;
    min-height: 80px;
    padding: 14px 18px;
}

.field input::placeholder,
.field textarea::placeholder { color: var(--muted); opacity: .7; }

/* file input customisation */
.field input[type="file"] {
    height: auto;
    padding: 12px 0;
    font-size: 1rem;
    cursor: pointer;
}

.field input[type="file"]::-webkit-file-upload-button,
.field input[type="file"]::file-selector-button {
    background: var(--accent);
    color: var(--bg);
    border: 0;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    margin-right: 12px;
}

.field input[type="file"]::-webkit-file-upload-button:hover,
.field input[type="file"]::file-selector-button:hover { filter: brightness(.95); }

/* badges inside fields */
.badge {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: var(--badge);
    height: var(--badge);
    border-radius: 50%;
    background: var(--accent);
    display: grid;
    place-items: center;
    box-shadow: 0 3px 10px rgba(0,0,0,.25);
}

.badge.left { left: 8px; }
.badge.right { right: 8px; }
.badge svg { width: 22px; height: 22px; color: #0b2430; }
.field.pad-left { padding-left: 62px; }
.field.pad-right { padding-right: 62px; }

/* ======================================================
   BUTTONS & INTERACTIVE
====================================================== */
.btn {
    height: var(--control-h);
    border-radius: var(--radius-pill);
    border: 1px solid transparent;
    font-weight: 800;
    letter-spacing: .6px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    background: var(--accent);
    color: #0c2b30;
    transition: filter .15s ease;
}

.btn:hover { filter: brightness(1.02) contrast(1.02); }

.btn.secondary {
    height: var(--control-h-sm);
    background: transparent;
    color: var(--muted);
    border-color: #ffffff66;
}

.btn.secondary:hover { background: #ffffff12; color: var(--accent); }

.btn.ghost {
    background: transparent;
    color: var(--txt);
    border-color: #ffffff66;
}

.btn.ghost:hover { background: #ffffff12; }

.iconbtn {
    --_size: var(--iconbtn);
    width: var(--_size);
    height: var(--_size);
    border-radius: 999px;
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    display: grid;
    place-items: center;
    transition: background .15s ease;
}

.iconbtn:hover { background: #ffffff33; }
.iconbtn svg { width: 20px; height: 20px; color: var(--txt); }

.iconbtn.tiny { --_size: var(--iconbtn-sm); }
.iconbtn.tiny svg { width: 18px; height: 18px; }

/* ======================================================
   TRACK & PLAYLIST LISTS
====================================================== */
.actions-row {
    display: flex;
    gap: 12px;
    margin-bottom: 0;
}

.actions-row.between { justify-content: space-between; align-items: center; }

.actions-row.top-actions {
    justify-content: center;
    flex-wrap: wrap;
}

.actions-row.top-actions .btn {
    width: auto;
    min-width: 220px;
    padding-inline: 20px;
    text-align: center;
}

.actions-row.top-actions .btn.ghost { min-width: 200px; }

.tracks {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 10px;
}

.track {
    display: grid;
    grid-template-columns: 40px 56px 1fr auto auto;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    border-radius: 14px;
}

.track.playing { outline: 2px solid #9fe7ff40; }

.idx {
    width: 40px;
    height: 40px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    background: #ffffff18;
    border: 1px solid #ffffff28;
    font-weight: 700;
}

.info { min-width: 0; }
.info .t,
.track-choice-title {
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.info .a,
.track-choice-meta {
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.info .a { font-size: .95rem; }
.dur { color: var(--muted); font-variant-numeric: tabular-nums; margin-right: 8px; }
.row-actions { display: flex; gap: 8px; }

.cover-thumb {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    overflow: hidden;
    display: grid;
    place-items: center;
    background: rgba(0,0,0,.18);
    border: 1px solid rgba(255,255,255,.16);
    color: var(--muted);
}

.cover-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.cover-thumb--empty { font-size: 1.5rem; }
.cover-thumb__placeholder { line-height: 1; }

.floating-player {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: max(12px, env(safe-area-inset-bottom, 12px));
    display: flex;
    align-items: center;
    gap: 14px;
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.25);
    backdrop-filter: blur(10px);
    padding: 10px 12px;
    border-radius: 999px;
    box-shadow: 0 12px 32px rgba(0,0,0,.35);
    z-index: 40;
    max-width: 92vw;
}

.fp-left,
.fp-right { display: flex; align-items: center; gap: 8px; }

.fp-center { min-width: 0; display: grid; }
.fp-title { font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fp-sub { color: var(--muted); font-size: .9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fp-time { color: var(--muted); font-variant-numeric: tabular-nums; }

/* ======================================================
   PLAYER PAGE MEDIA BLOCKS
====================================================== */
.media { display: grid; gap: 18px; }
.cover img {
    width: 100%;
    height: auto;
    border-radius: 16px;
    display: block;
    box-shadow: 0 16px 40px rgba(0,0,0,.35);
}

.meta .song-title { margin: .4rem 0 .2rem; font-size: 1.6rem; font-weight: 800; }
.meta .artist { margin: 0; color: var(--txt); opacity: .9; }
.meta .albumline { margin: .2rem 0 0; color: var(--muted); }
.audio-box audio { width: 100%; }
.time-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
    color: var(--muted);
    font-variant-numeric: tabular-nums;
}

/* ======================================================
   HOME PAGE SHELL (HEADER + RAIL)
====================================================== */
.header {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 12px;
    padding: 12px var(--page-pad);
    position: sticky;
    top: 0;
    z-index: 100;
    background: linear-gradient(to bottom, rgba(6,42,44,.96), rgba(6,42,44,.76));
    border-bottom: 1px solid var(--pill-brd);
    -webkit-backdrop-filter: blur(6px);
    backdrop-filter: blur(6px);
}

.header-left { justify-self: start; max-width: 420px; width: 100%; }
.header-title {
    margin: 0;
    text-align: center;
    font-weight: 800;
    font-size: clamp(1.3rem, 1rem + 1.6vw, 2.2rem);
}

.header-right {
    justify-self: end;
    width: auto;
    min-width: 140px;
    padding-inline: 15px;
    text-align: center;
}

.main {
    flex: 1;
    padding: 16px var(--page-pad) 24px;
    display: grid;
    gap: 16px;
}

.board {
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    border-radius: 16px;
    padding: 18px;
    max-width: min(1280px, 98vw);
    margin: 32px auto 0;
    box-shadow: 0 14px 40px rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
}

.field.search { flex: 1; max-width: 420px; }

.grid.playlists {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 10px;
}

.pl-card {
    display: grid;
    gap: 10px;
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    border-radius: 16px;
    padding: 12px;
    color: inherit;
    transition: background .15s ease, transform .08s ease;
}

.pl-card:hover { background: #ffffff22; transform: translateY(-1px); }

.pl-meta { display: grid; gap: 2px; }
.pl-name { margin: 0; font-weight: 800; }
.pl-sub { margin: 0; color: var(--muted); }

.rail {
    display: flex;
    gap: 14px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding-bottom: 8px;
    scrollbar-width: thin;
    scrollbar-color: #9fe7ff44 transparent;
}

.rail .pl-card { flex: 0 0 220px; scroll-snap-align: start; }
.board .rail { justify-content: center; }

.rail::-webkit-scrollbar { height: 8px; }
.rail::-webkit-scrollbar-track { background: transparent; }
.rail::-webkit-scrollbar-thumb { background: #9fe7ff44; border-radius: 999px; }
.rail::-webkit-scrollbar-thumb:hover { background: #9fe7ff66; }

.divider { height: 1px; background: var(--pill-brd); border: 0; margin: 12px 0 20px; }
.topbar { display: none !important; }

/* corner buttons reused on multiple pages */
.corner {
    position: fixed;
    z-index: 50;
    backdrop-filter: blur(6px);
}

.corner-left { top: var(--safe-top); left: var(--safe-left); }
.corner-right { top: var(--safe-top); right: var(--safe-right); }
.corner-center { top: var(--safe-top); left: 50%; transform: translateX(-50%); }

/* ======================================================
   PLAYLIST CREATION MODAL
====================================================== */
.playlist-tracks-block { display: grid; gap: 10px; }
.playlist-tracks-tools { display: flex; gap: 10px; align-items: center; }
.playlist-tracks-tools .field { height: 42px; --control-h: 42px; }
.playlist-tracks-tools .counts {
    font-size: .7rem;
    letter-spacing: .5px;
    text-transform: uppercase;
    color: var(--muted);
}

.playlist-tracks-list {
    list-style: none;
    margin: 0;
    padding: 10px;
    display: grid;
    gap: 6px;
    max-height: 300px;
    overflow: auto;
    border: 1px solid var(--pill-brd);
    border-radius: 12px;
    background: var(--pill);
}

.playlist-tracks-empty { font-size: .8rem; opacity: .8; padding: 6px 4px; }

.track-choice {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    padding: 6px 8px;
    background: rgba(255,255,255,.05);
    border: 1px solid var(--pill-brd);
    border-radius: 9px;
    cursor: pointer;
    transition: background .15s ease, border-color .15s ease;
}

.track-choice:hover { background: rgba(255,255,255,.1); }
.track-choice input { margin-top: 2px; }
.track-choice-meta { font-size: .7rem; line-height: 1.1; }
.track-choice-title { font-size: .9rem; line-height: 1.15; }
.track-choice--selected { border-color: #9fe7ff88; background: rgba(159,231,255,.08); }

.playlist-tracks-actions {
    display: flex;
    gap: 8px;
    justify-content: space-between;
}

.playlist-tracks-actions button {
    height: 32px;
    padding: 0 14px;
    border-radius: 20px;
    font-size: .7rem;
    font-weight: 600;
    letter-spacing: .5px;
    background: rgba(255,255,255,.15);
    color: var(--txt);
    border: 1px solid var(--pill-brd);
    cursor: pointer;
}

.playlist-tracks-actions button:hover { background: rgba(255,255,255,.25); }

/* ======================================================
   MODALS
====================================================== */
.modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background: rgba(0, 0, 0, .7);
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    animation: fade-in .2s ease-out;
}

.modal-overlay.active {
    display: flex;
    position: fixed;
    -webkit-overflow-scrolling: touch;
}

.modal {
    position: relative;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    padding: 24px;
    border-radius: 16px;
    background: var(--bg);
    border: 1px solid var(--pill-brd);
    box-shadow: 0 20px 60px rgba(0,0,0,.5);
    overflow-y: auto;
    transform: scale(.95);
    opacity: 0;
    transition: transform .2s ease-out, opacity .2s ease-out;
}

.modal-overlay.active .modal {
    transform: scale(1);
    opacity: 1;
    animation: slide-in .2s ease-out;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--pill-brd);
}

.modal-title {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 800;
}

.modal-close {
    background: transparent;
    border: 0;
    color: var(--muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 4px;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: grid;
    place-items: center;
}

.modal-close:hover { background: var(--pill); color: var(--txt); }
.modal-content { display: grid; gap: 16px; }
.modal-actions {
    display: flex;
    gap: 12px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--pill-brd);
}

.modal:focus-visible { outline: none; }

@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes slide-in {
    from { transform: scale(.9) translateY(-10px); opacity: 0; }
    to   { transform: scale(1) translateY(0); opacity: 1; }
}

/* ======================================================
   PLAYLISTS GRID 3x3 (override nuovo layout)
====================================================== */
.playlists-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
    margin-top: 10px;
    /* rimuove eventuale comportamento ereditato di flex/rail */
    overflow: visible;
}

.playlists-grid .pl-card {
    /* Manteniamo lo stesso stile delle card originali; larghezza automatica per riempire la colonna */
    flex: initial; /* annulla il flex-basis definito per .rail .pl-card */
}

/* Responsive: passa a 2 colonne su medium, 1 colonna su small */
@media (max-width: 980px) {
    .playlists-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 620px) {
    .playlists-grid { grid-template-columns: 1fr; }
}

/* ======================================================
   PLAYLIST PAGE (ROW OF 5 + PAGINATION)
====================================================== */
.playlist-page { margin-top: 10px; }
.subtitle { margin: 40px 0 14px; font-size: 1.25rem; font-weight: 800; text-align: center; }
.muted-msg { margin: 8px 0 0; text-align: center; font-size: .85rem; color: var(--muted); }

.playlist-browser { display: grid; gap: 18px; }
.playlist-nav-row { display: flex; align-items: stretch; gap: 14px; }
.playlist-nav-btn { width: 140px; flex: 0 0 auto; }

/* Single row that hosts up to 5 cells */
.playlist-row { flex: 1; display: flex; gap: 14px; }
.playlist-row:empty { min-height: 180px; }

.playlist-cell {
    flex: 1 1 0;
    min-width: 0; /* evita overflow testo */
    display: grid;
    gap: 10px;
    padding: 14px 14px 16px;
    background: var(--pill);
    border: 1px solid var(--pill-brd);
    border-radius: 18px;
    text-align: center;
    color: inherit;
    position: relative;
    text-decoration: none;
    transition: background .15s ease, transform .12s ease;
}
.playlist-cell:hover { background: #ffffff22; transform: translateY(-2px); }
.playlist-cell:active { transform: translateY(0); }

.pl-cover { width: 100%; aspect-ratio: 1 / 1; border-radius: 14px; overflow: hidden; background: rgba(255,255,255,.08); display: grid; place-items: center; position: relative; }
.pl-cover img { width: 100%; height: 100%; object-fit: cover; display: block; }
.pl-cover-placeholder { font-size: 2rem; opacity: .7; }

.pl-meta { display: grid; gap: 2px; }
.pl-song-title { font-weight: 800; font-size: .9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pl-artist { font-size: .7rem; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: .4px; }
.pl-album { font-size: .6rem; color: var(--muted); opacity: .85; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: .3px; }

/* Riduzioni su schermi piccoli: manteniamo la singola riga scrollabile orizzontalmente se necessario */
@media (max-width: 680px) {
    .playlist-row { overflow-x: auto; padding-bottom: 4px; -webkit-overflow-scrolling: touch; }
    .playlist-cell { min-width: 160px; flex: 0 0 160px; }
    .playlist-nav-btn { width: 110px; }
}

@media (max-width: 460px) {
    .playlist-cell { min-width: 140px; flex: 0 0 140px; padding: 12px 12px 14px; }
    .pl-song-title { font-size: .8rem; }
    .pl-artist { font-size: .65rem; }
    .pl-album { display: none; }
}

/* ======================================================
   RESPONSIVE TWEAKS
====================================================== */
@media (max-width: 560px) {
    .track { grid-template-columns: 36px 46px 1fr auto auto; padding: 10px 12px; }
    .idx { width: 36px; height: 36px; }
    .dur { display: none; }
    .fp-sub { display: none; }
    .header { grid-template-columns: 1fr auto 1fr; }
    .header-left { max-width: 100%; }
    .actions-row.top-actions .btn { width: 100%; }
    .rail .pl-card { flex-basis: 180px; }
}

@media (max-width: 480px) {
    .grid.playlists { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
}

/* ======================================================
   BROWSER POLISH
====================================================== */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
    -webkit-box-shadow: 0 0 0 30px var(--pill) inset !important;
    -webkit-text-fill-color: var(--txt) !important;
}

input:invalid { box-shadow: none; }
input:focus:invalid { outline: 2px solid #ff6b6b; }

.modal-overlay::-webkit-scrollbar,
.playlist-tracks-list::-webkit-scrollbar,
.tracks-selection::-webkit-scrollbar {
    width: 8px;
}

.playlist-tracks-list::-webkit-scrollbar-track,
.tracks-selection::-webkit-scrollbar-track { background: transparent; }

.playlist-tracks-list::-webkit-scrollbar-thumb,
.tracks-selection::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 4px;
}

.playlist-tracks-list::-webkit-scrollbar-thumb:hover,
.tracks-selection::-webkit-scrollbar-thumb:hover { background: var(--txt); }

@supports (-webkit-touch-callout: none) {
    .modal { transform: translate3d(0,0,0); }
    .modal-overlay.active { -webkit-overflow-scrolling: touch; }
}

@media screen and (-webkit-min-device-pixel-ratio: 0) {
    .field input[type="file"]::-webkit-file-upload-button {
        -webkit-appearance: none;
        appearance: none;
    }
}
