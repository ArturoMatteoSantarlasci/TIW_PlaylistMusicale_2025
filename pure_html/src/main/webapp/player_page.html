<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Player • Playlist Manager</title>
    <link rel="stylesheet" href="css/app.css" th:href="@{/css/app.css}" />
    <link rel="icon" sizes="32x32" type="image/png" href="img/icon.png" th:href="@{/img/icon.png}">
</head>
<body class="page-home">
    <header class="header">
        <div></div>
        <h1 class="header-title">Player</h1>
        <div style="text-align:right">
            <a class="btn secondary" th:href="${tracksUrl}" href="All_Tracks.html">Tutte le tracce</a>
        </div>
    </header>

    <div class="player-track-info">
        <div class="player-cover">
            <img src="https://via.placeholder.com/640x640?text=Cover" th:src="${track.coverUrl}" alt="Copertina" />
        </div>
        <div class="player-text">
            <div class="player-title" th:text="${track.title}">Titolo</div>
            <div class="player-artist" th:text="${track.artist}">Artista</div>
            <div class="player-album" th:if="${track.albumLine != null}" th:text="${track.albumLine}">Album · 2025 · Genere</div>
            <div style="display:flex; gap:10px; align-items:center; margin-top:6px; flex-wrap:wrap;">
                <span th:if="${prevTrack == null}" class="iconbtn" style="opacity:.35;pointer-events:none;" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M6 5v14M18 6l-8 6 8 6V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </span>
                <a th:if="${prevTrack != null}" class="iconbtn" th:href="@{/player(trackId=${prevTrack.trackId})}" title="Precedente">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M6 5v14M18 6l-8 6 8 6V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </a>
                <a th:if="${nextTrack != null}" class="iconbtn" th:href="@{/player(trackId=${nextTrack.trackId})}" title="Successivo">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M18 19V5M6 18l8-6-8-6v12z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </a>
                <span th:if="${nextTrack == null}" class="iconbtn" style="opacity:.35;pointer-events:none;" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M18 19V5M6 18l8-6-8-6v12z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </span>
            </div>
            <audio id="audio" controls preload="metadata" th:src="${track.audioUrl}" style="margin-top:10px;"></audio>
            <div class="time-row" style="margin-top:4px;">
                <span id="elapsed">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>
    </div>

<script>
    // Aggiorna i tempi (passati/totali) in mm:ss
    document.addEventListener("DOMContentLoaded", () => {
        const audio = document.getElementById("audio");
        const elapsed = document.getElementById("elapsed");
        const duration = document.getElementById("duration");

        const fmt = (s) => {
            if (!isFinite(s) || s < 0) return "0:00";
            s = Math.floor(s);
            const m = Math.floor(s / 60);
            const ss = String(s % 60).padStart(2, "0");
            return `${m}:${ss}`;
        };

        const setDuration = () => {
            if (!isNaN(audio.duration)) duration.textContent = fmt(audio.duration);
        };

        audio.addEventListener("loadedmetadata", setDuration);
        audio.addEventListener("durationchange", setDuration);
        audio.addEventListener("timeupdate", () => {
            elapsed.textContent = fmt(audio.currentTime);
        });
    });
</script>
    </body>
</html>
