<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Player • Playlist Manager</title>
    <link rel="stylesheet" href="css/app.css" th:href="@{/css/app.css}" />
    <link rel="icon" sizes="32x32" type="image/png" href="img/icon.png" th:href="@{/img/icon.png}">
</head>
<body>
<div class="wrap wide">
    <!-- Top bar: indietro + home -->
    <div class="topbar" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <a class="iconbtn" th:href="${tracksUrl}" href="All_Tracks.html" title="Torna a tutte le tracce">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 6l-6 6 6 6"/></svg>
        </a>
        <a class="iconbtn" href="index.html" th:href="@{/}" aria-label="Vai alla Home">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 8h-3v10H6V11H3z"/></svg>
        </a>
    </div>

    <article class="media">
        <!-- Copertina -->
        <div class="cover">
            <img
                    src="https://via.placeholder.com/640x640?text=Cover"
                    th:src="${track.coverUrl}"
                    alt="Copertina album" />
        </div>

        <!-- Metadati -->
        <div class="meta">
            <h2 class="song-title" th:text="${track.title}">Titolo del brano</h2>
            <p class="artist" th:text="${track.artist}">Artista</p>
            <p class="albumline" th:if="${track.albumLine != null}" th:text="${track.albumLine}">Album · 2025 · Genere</p>
        </div>

        <!-- Player -->
        <div class="audio-box">
            <div style="display:flex; justify-content:center; align-items:center; gap:12px; margin-bottom:12px;">
                <span th:if="${prevTrack == null}" class="iconbtn" style="opacity:.4; pointer-events:none;" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M6 5v14M18 6l-8 6 8 6V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </span>
                <a th:if="${prevTrack != null}" class="iconbtn" th:href="@{/player(trackId=${prevTrack.trackId})}" title="Traccia precedente">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M6 5v14M18 6l-8 6 8 6V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </a>

                <a th:if="${nextTrack != null}" class="iconbtn" th:href="@{/player(trackId=${nextTrack.trackId})}" title="Traccia successiva">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M18 19V5M6 18l8-6-8-6v12z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </a>
                <span th:if="${nextTrack == null}" class="iconbtn" style="opacity:.4; pointer-events:none;" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M18 19V5M6 18l8-6-8-6v12z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </span>
            </div>
            <audio id="audio" controls preload="metadata"
                   src="sample.mp3" th:src="${track.audioUrl}"></audio>

            <!-- tempi mm:ss -->
            <div class="time-row">
                <span id="elapsed">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>
    </article>
</div>

<script>
    // Aggiorna i tempi (passati/totali) in mm:ss
    document.addEventListener("DOMContentLoaded", () => {
        const audio = document.getElementById("audio");
        const elapsed = document.getElementById("elapsed");
        const duration = document.getElementById("duration");

        const fmt = (s) => {
            if (!isFinite(s) || s < 0) return "0:00";
            s = Math.floor(s);
            const m = Math.floor(s / 60);
            const ss = String(s % 60).padStart(2, "0");
            return `${m}:${ss}`;
        };

        const setDuration = () => {
            if (!isNaN(audio.duration)) duration.textContent = fmt(audio.duration);
        };

        audio.addEventListener("loadedmetadata", setDuration);
        audio.addEventListener("durationchange", setDuration);
        audio.addEventListener("timeupdate", () => {
            elapsed.textContent = fmt(audio.currentTime);
        });
    });
</script>
</body>
</html>
